<html> 
    <head> 
        <title>Frogger</title> 
        <style> body { margin: 0; } canvas { width: 100%; height: 100% } </style> 
    </head> 

    <body> 
        <script src="three.js"></script> 

        <!-- Shaders -->
        <script type="x-shader/x-vertex" id="vertexShader">

            varying vec3 vNormal;
            varying vec3 eye;

            void main() {

            vNormal = normal;
            
            vec4 eyeAux = -(modelViewMatrix * vec4( position, 1.0 ));
            eye = normalize(eyeAux.xyz);

            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

            }

        </script>

        <script type="x-shader/x-fragment" id="fragmentShader">


            uniform vec3 ambient;
            uniform vec3 diffuse;
            uniform vec3 spec;
            uniform float shininess;
            uniform float offset;

            varying vec3 vNormal;
            varying vec3 eye;

            void main() {

                vec3 light = vec3(0.0, 0.0, 1.0);
                light = normalize(light);
                
                float dProd = max(0.0, dot(vNormal, light));
                vec3 l_diff = dProd * diffuse;
                
                vec3 l_spec = vec3(0.0, 0.0, 0.0);
                
                if(dProd > 0.0){
                    vec3 h = normalize( eye + light);
                    float int_spec = max(dot(h,vNormal), 0.0);
                    l_spec = spec * max( pow(int_spec, shininess), 0.0); 
                }
                
                vec3 sum = l_diff + l_spec;
                vec3 color = max(ambient, sum);
                gl_FragColor = vec4(color, 1.0);
            }

        </script>

        <script>
            
            ///////////////////////////////////////////////////////////////////////////////// Main Variables
            var scene = new THREE.Scene();
            
            // Shader Association
            var vertexShader = document.getElementById('vertexShader').textContent;
            var fragmentShader = document.getElementById('fragmentShader').textContent;

            var camera;
            
            var renderer = new THREE.WebGLRenderer();
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            var frog;
            var left = false;
            var right = false;
            var up = false;
            var down = false;

            var camType = 1;

            ///////////////////////////////////////////////////////////////////////////////// Camera Functions

            function updateCamera() {
                if (camType === 1) {
                    camera = new THREE.OrthographicCamera(window.innerWidth / -100, window.innerWidth / 100,
                            window.innerHeight / 100, window.innerHeight / -100, -500, 1000);
                    camera.position.z = 9.0;
                }
                else if (camType === 2) {
                    camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
                    camera.position.z = 9.0;
                }
                else {
                    camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
                    camera.position.set(frog.position.x, frog.position.y - 1, frog.position.z + 1);
                    camera.lookAt(frog.position);
                }
                
            }

            //////////////////////////////////////////////////////////////////////////////// Objects

            ///////////////////////////////////////////////////////////////// Static Objects

            function Road() {

                var geometry = new THREE.BoxGeometry(10, 4, 2);
                var material = new THREE.MeshBasicMaterial({color: 0x292914});

                this.road = new THREE.Mesh(geometry, material);
                this.road.position.y = -2.5;

                scene.add(this.road);
            }

            function River() {
                
                var uniforms = {
                 ambient: {type: "c", value: new THREE.Color(0x001A0F)},
                 diffuse: {type: "c", value: new THREE.Color(0x008282)},
                 spec: {type: "c", value: new THREE.Color(0x808080)},
                 shininess: {type: "f", value: 32}
                };
                
                var geometry = new THREE.BoxGeometry(10, 4, 2);
                var material = new THREE.ShaderMaterial({vertexShader: vertexShader, fragmentShader: fragmentShader, uniforms: uniforms});

                this.river = new THREE.Mesh(geometry, material);
                this.river.position.y = 2.5;
                scene.add(this.river);
            }


            function RoadSide() {
                var geometry = new THREE.BoxGeometry(10, 1, 2);
                var material = new THREE.MeshBasicMaterial({color: 0xFFFF66});

                this.roadside = new THREE.Mesh(geometry, material);
                this.roadside.position.y = -5;
                scene.add(this.roadside);
            }

            function RiverSides() {
                var geometry = new THREE.BoxGeometry(10, 1, 2);
                var material = new THREE.MeshBasicMaterial({color: 0x009900});

                this.rs1 = new THREE.Mesh(geometry, material);
                this.rs2 = new THREE.Mesh(geometry, material);

                this.rs1.position.y = 0;
                this.rs2.position.y = 5;

                scene.add(this.rs1);
                scene.add(this.rs2);
            }


            ///////////////////////////////////////////////////////////////// Dynamic Objects
            function Frog() {

                var uniforms = {
                 ambient: {type: "c", value: new THREE.Color(0x052D05)},
                 diffuse: {type: "c", value: new THREE.Color(0x139913)},
                 spec: {type: "c", value: new THREE.Color(0xA1B7A1)},
                 shininess: {type: "f", value: 20}
                };
                
                var geometry = new THREE.SphereGeometry(0.25, 32, 32);
                var material = new THREE.ShaderMaterial({vertexShader: vertexShader, fragmentShader: fragmentShader, uniforms: uniforms});


                frog = new THREE.Mesh(geometry, material);
                frog.position.y = -5;
                frog.position.z = 1;
                scene.add(frog);
            }

            ///////////////////////////////////////////////////////////////// Movement Functions

            document.addEventListener('keydown', onDocumentKeyDown, false);
            function onDocumentKeyDown(event) {
                event = event || window.event;
                var keycode = event.keyCode;
                switch (keycode) {
                    case 37 : //left arrow
                        left = true;
                        /*var mytext = "Hello again";
                         document.write(mytext);*/
                        break;
                    case 38 : // up arrow 
                        up = true;
                        break;
                    case 39 : // right arrow
                        right = true;
                        break;
                    case 40 : //down arrow
                        down = true;
                        break;
                    case 49 : //1 button ortogonal camera 
                        camType = 1;
                        break;
                    case 50 : //2 button perspective camera
                        camType = 2;
                        break;
                    case 51 : //3 button 3rd person camera
                        camType = 3;
                        break;
                }
                document.addEventListener('keyup', onDocumentKeyUp, false);
            }

            function onDocumentKeyUp(event) {
                event = event || window.event;
                var keycode = event.keyCode;
                switch (keycode) {
                    case 37 : //left arrow
                        left = false;
                        /*var mytext = "Hello again";
                         document.write(mytext);*/
                        break;
                    case 38 : // up arrow 
                        up = false;
                        break;
                    case 39 : // right arrow
                        right = false;
                        break;
                    case 40 : //down arrow
                        down = false;
                        break;
                }
            }

            function updateFrog() {
                var delta = 0.03;
                if (left) {
                    frog.position.x -= delta;
                }
                if (right) {
                    frog.position.x += delta;
                }
                if (up) {
                    frog.position.y += delta;
                }
                if (down) {
                    frog.position.y -= delta;
                }

            }

            //////////////////////////////////////////////////////////////////////////////// Lights  

            //Directional Light
            function direccionalLight() {
                var dirLight = new THREE.DirectionalLight(0xffffff, 0.5);
                dirLight.color.setHSL(0.1, 1, 0.95);
                dirLight.position.set(-1, 1.75, 1);
                dirLight.position.multiplyScalar(50);
                scene.add(dirLight);

            }
        </script>

        <script>

            // Create Objects
            var road = new Road();
            var river = new River();
            var frogger = new Frog();
            var roadside = new RoadSide();
            var riversides = new RiverSides();
            direccionalLight();

            // Render Scene
            var render = function () {
                updateCamera();
                updateFrog();
                requestAnimationFrame(render);
                renderer.render(scene, camera);
            };

            render();
        </script> 
    </body> 
</html>