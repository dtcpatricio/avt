<html> 
    <head> 
        <title>Frogger</title> 
        <style> body { margin: 0; } canvas { width: 100%; height: 100% } </style> 
    </head> 

    <body> 
        <script src="three.js"></script> 
        <script src="DynamicObj/Bus.js"></script>
        <script src="DynamicObj/Car.js"></script>
        <script src="DynamicObj/Frog.js"></script>
        <script src="StaticObj/River.js"></script>
        <script src="StaticObj/Road.js"></script>
        <script src="StaticObj/Riversides.js"></script>
        <script src="StaticObj/Roadside.js"></script>
        <script src="DynamicObj/TimberLog.js"></script>
        <script src="DynamicObj/Turtle.js"></script>
        <script src="StaticObj/Tunnels.js"></script>

        <!-- Shaders -->
        <script type="x-shader/x-vertex" id="vertexShader">

            varying vec3 vNormal;
            varying vec3 eye;
            varying vec2 vUv;

            void main() {

            vNormal = normal;
            vUv = uv;

            vec4 eyeAux = -(modelViewMatrix * vec4( position, 1.0 ));
            eye = normalize(eyeAux.xyz);

            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

            }

        </script>

        <script type="x-shader/x-fragment" id="fragmentShader">


            uniform vec3 ambient;
            uniform vec3 diffuse;
            uniform vec3 spec;
            uniform float shininess;
            uniform float dirOn;
            uniform float texMode;
            uniform sampler2D texture1;

            varying vec2 vUv;
            varying vec3 vNormal;
            varying vec3 eye;
            
            void main() {

                vec4 sum = vec4(0.0, 0.0, 0.0, 0.0);
                vec3 light = vec3(1.0, 0.0, 1.0);
                light = normalize(light);
                
                vec3 vAux = normalize(vNormal);
                vec4 texel;
                vec4 texLight;

                //if(dirOn == 1.0){
                    float dProd = max(0.0, dot(vAux, light));
                    vec3 l_diff = dProd * diffuse;
                    vec3 l_spec = vec3(0.0, 0.0, 0.0);

                    if(dProd > 0.0){
                         vec3 h = normalize(eye + light);
                         float int_spec = max(dot(h,vAux), 0.0);
                         l_spec = spec * max( pow(int_spec, shininess), 0.0);
                         
                         
                        if(texMode == 1.0){
                            texel = texture2D(texture1, vUv);
                            texLight = texel * dProd + vec4(l_spec, 1.0);
                            sum = texLight;        
                        }
                        else{
                            sum = vec4(l_diff + l_spec, 1.0);
                        }
                         
                    }
                
                if(texMode == 1.0){
                    gl_FragColor = sum;
                }
                else{
                    vec3 color = max(ambient, sum.rgb);
                    gl_FragColor= vec4(color, 1.0);
                }
            }
            

        </script>

        <script>

///////////////////////////////////////////////////////////////////////////////// Main Variables
var scene = new THREE.Scene();
var camera;
var camType = 1;
var globalOn = 1.0;

// Shader Association
var vertexShader = document.getElementById('vertexShader').textContent;
var fragmentShader = document.getElementById('fragmentShader').textContent;

var renderer = new THREE.WebGLRenderer();
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

///////////////////////////////////////////////////////////////////////////////// Camera Functions

function updateCamera() {
    if (camType === 1) {
        camera = new THREE.OrthographicCamera(window.innerWidth / -100, window.innerWidth / 100,
                window.innerHeight / 100, window.innerHeight / -100, -500, 1000);
        camera.position.z = 9.0;
    }
    else if (camType === 2) {
        camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.z = 9.0;
    }
    else {
        camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(frog[0].position.x, frog[0].position.y - 1, frog[0].position.z + 1);
        camera.lookAt(frog[1].position);
    }

}

///////////////////////////////////////////////////////////////// Keyboard Callbacks

document.addEventListener('keydown', onDocumentKeyDown, false);
function onDocumentKeyDown(event) {
    event = event || window.event;
    var keycode = event.keyCode;
    switch (keycode) {
        case 37 : //left arrow
            left = true;
            /*var mytext = "Hello again";
             document.write(mytext);*/
            break;
        case 38 : // up arrow 
            up = true;
            break;
        case 39 : // right arrow
            right = true;
            break;
        case 40 : //down arrow
            down = true;
            break;
        case 49 : //1 button ortogonal camera 
            camType = 1;
            break;
        case 50 : //2 button perspective camera
            camType = 2;
            break;
        case 51 : //3 button 3rd person camera
            camType = 3;
            break;
        case 78 :
            if (globalOn === 1.0)
                globalOn = 0.0;
            else
                globalOn = 1.0;

    }
    document.addEventListener('keyup', onDocumentKeyUp, false);
}

function onDocumentKeyUp(event) {
    event = event || window.event;
    var keycode = event.keyCode;
    switch (keycode) {
        case 37 : //left arrow
            left = false;
            /*var mytext = "Hello again";
             document.write(mytext);*/
            break;
        case 38 : // up arrow 
            up = false;
            break;
        case 39 : // right arrow
            right = false;
            break;
        case 40 : //down arrow
            down = false;
            break;
    }
}


function collision() {

    frogBoundBox();

    var auxCars = allCars();
    var auxBus = allBus();
    var auxLogs = allLogs();
    var auxTurtles = allTurtles();

    var bbCar;
    var bbBus;
    var bbLog;
    var bbTurtle;

    var collideBottom = 0.0;
    var collideUpL = 0.0;
    var collideUpT = 0.0;

    var frogBB = frogBoundBox();

    for (i = 0; i < auxCars.length; i += 5) {
        bbCar = carBoundBox(auxCars[i]);
        if (bbCar.isIntersectionBox(frogBB))
            collideBottom = 1.0;
    }

    for (i = 0; i < auxBus.length; i += 5) {
        bbBus = busBoundBox(auxBus[i]);
        if (bbBus.isIntersectionBox(frogBB))
            collideBottom = 1.0;
    }

    for (i = 0; i < auxLogs.length; i++) {
        bbLog = logBoundBox(auxLogs[i]);
        if (bbLog.isIntersectionBox(frogBB))
            collideUpL = 1.0;
    }

    for (i = 0; i < auxTurtles.length; i++) {
        bbTurtle = turtleBoundBox(auxTurtles[i]);
        if (bbTurtle.isIntersectionBox(frogBB))
            collideUpT = 1.0;
    }

    if (collideBottom === 1.0)
        initialPosition();

    if (frog[0].position.y > 0.7 && frog[0].position.y < 4.5) {
        if (collideUpL === 1.0)
            setPosition(0.04);
        else if (collideUpT === 1.0)
            setPosition(0.01);
        else
            initialPosition();

    }

}



        </script>

        <script>

            // Create Objects
            var road = new Road();
            var roadside = new RoadSide();
            var riversides = new RiverSides();
            var tunnels = new Tunnels();

            var frogger = new Frog();
            var cars = new Cars();
            var buses = new Bus();
            var logs = new TimberLog();
            var tortoises = new Turtles();
            var river = new River();

            // Render Scene
            var render = function () {
                updateCamera();

                updateFrog();
                updateBus();
                updateCars();
                updateLogs();
                updateTurtles();

                collision();

                requestAnimationFrame(render);
                renderer.render(scene, camera);
            };

            render();
        </script> 
    </body> 
</html>